---
title: æ¡ä»¶éšæœºåœºCRF
date: '2022/11/19 19:42:10'
top_img: 'https://pic.hycbook.com/i//hexo/post_imgs/è•¾å§†0.webp'
cover: 'https://pic.hycbook.com/i//hexo/post_cover/è•¾å§†0.webp'
categories:
  - machine_learning
tags:
  - æœºå™¨å­¦ä¹ 
  - æ¡ä»¶éšæœºåœºCRF
mathjax: true
description: æœºå™¨å­¦ä¹ ä¹‹æ¡ä»¶éšæœºåœºCRF
abbrlink: 12117
---

---



# å‰ç½®çŸ¥è¯†

> ç¬”è®°æ•´ç†è‡ªï¼šBilibiliç«™ä¸Š[shuhuai008](https://space.bilibili.com/97068901)å¼ºåŠ¿æ‰‹æ¨è®²è§£çš„[ç™½æ¿æ¨å¯¼CRFç³»åˆ—è¯¾ç¨‹](https://www.bilibili.com/video/av34444816/?p=1)ï¼Œè¯¾ç¨‹è´¨é‡å¾ˆé«˜ï¼
>
> [æ¡ä»¶éšæœºåœº](https://www.yuque.com/bystander-wg876/yc5f72/ox2qgv)
>
> [ã€NLPã€‘ä»éšé©¬å°”ç§‘å¤«åˆ°æ¡ä»¶éšæœºåœº](https://anxiang1836.github.io/2019/11/05/NLP_From_HMM_to_CRF/)

> åˆ†ç±»é—®é¢˜æ ¹æ®è¾“å‡ºçš„ç±»å‹ï¼Œå¯ä»¥å°†å…¶åˆ’åˆ†ä¸º`ç¡¬æ¨¡å‹`å’Œ`è½¯æ¨¡å‹`

* **ç¡¬è¾“å‡º**: è¾“å‡ºä¸º0æˆ–1

* **è½¯è¾“å‡º**: å¼•å…¥æ¦‚ç‡ï¼Œä¸ç›´æ¥è®¡ç®—è¾¹ç•Œï¼Œè€Œæ˜¯è®¡ç®—å–å„ç±»åˆ«çš„æ¦‚ç‡

## è½¯ç¡¬æ¨¡å‹

### ç¡¬æ¨¡å‹

> svmæ”¯æŒå‘é‡æœº(æœ€å¤§é—´éš”)

å‡ ä½•è§’åº¦å‡ºå‘ï¼Œæ±‚çš„æ˜¯max margin classifierï¼Œå¼å­æœ€ç»ˆçš„å½¢å¼ä¸º
$$
min (\frac {1}{2} w^Tw) \qquad s.t. \ y_i(w^Tx_i+b) \geq1,i=1,\cdots,N
$$

> PLAæ„ŸçŸ¥æœºï¼Œå¯ä»¥çœ‹ä½œæœ€åŸºæœ¬çš„ç¥ç»å…ƒ

$$
f(w) = sign(w^Tx)
$$

> LDAçº¿æ€§åˆ¤åˆ«åˆ†æ(è¯¯åˆ†ç±»é©±åŠ¨)

æ ¸å¿ƒæ€æƒ³: ç±»é—´å¤§ã€ç±»å†…å°



### è½¯æ¨¡å‹

#### æ¦‚ç‡åˆ¤åˆ«æ¨¡å‹

> å»ºæ¨¡æ ¸å¿ƒ

æ˜¯å¯¹$$P(x,y)$$è¿›è¡Œå»ºæ¨¡

> ä¾‹å­_é€»è¾‘å›å½’(Logistics Regression, LR)ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥å«SoftMax Regression

> ä¾‹å­_æœ€å¤§ç†µæ¨¡å‹(Maximum Entropy Model, MEM)

åˆ©ç”¨æœ€å¤§ç†µæ€æƒ³(Maximum Entropy Model)é©±åŠ¨æ¨¡å‹ï¼Œä»ç†µæ¨¡å‹æ¥çœ‹ï¼ŒLGæ˜¯ç†µæ¨¡å‹çš„ä¸€ä¸ªç‰¹ä¾‹

åœ¨æœ€å¤§ç†µåŸåˆ™ä¸‹ï¼Œå¦‚æœç»™å®šå‡å€¼å’Œæ–¹å·®ï¼Œé‚£ä¹ˆGaussian Distç†µæœ€å¤§

> ä¾‹å­_æœ€å¤§ç†µé©¬å°”ç§‘å¤«æ¨¡å‹(Maximum Entropy Markov Model, MEMM)

ç»“åˆäº†MEMå’ŒHMMå½¢æˆäº†MEMMï¼Œå›¾æ¨¡å‹å¯ä»¥è¡¨è¾¾æˆé»„çº¿éƒ¨åˆ†(å…¨å±€å½±å“)æˆ–ç»¿çº¿éƒ¨åˆ†(å±€éƒ¨å½±å“)ï¼Œè¡¨è¾¾æˆç»¿çº¿æ˜¯ä¸ºäº†å’ŒHMMå¯¹æ¯”

![æœ€å¤§ç†µé©¬å°”ç§‘å¤«å›¾æ¨¡å‹](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/æœ€å¤§ç†µé©¬å°”ç§‘å¤«å›¾æ¨¡å‹.webp)

**æ½œåœ¨é—®é¢˜**: `æ ‡æ³¨åå·®é—®é¢˜`

æ ‡æ³¨åå·®é—®é¢˜(Label Bias Problem): åŸå› æ˜¯å› ä¸º`å±€éƒ¨å½’ä¸€åŒ–`ï¼Œä¸Šå›¾ä¸­ç°è‰²è™šçº¿å¯ä»¥è¡¨è¾¾ä¸º$$p(y_2|y_1,x_2)$$ï¼Œè¿™éƒ¨åˆ†è¦æ±‚ç¬¦åˆæ¦‚ç‡åˆ†å¸ƒï¼Œå› æ­¤éœ€è¦å½’ä¸€åŒ–ï¼Œå¼ºåˆ¶å˜ä¸ºæ¦‚ç‡åˆ†å¸ƒ

**ä¸å…¶ä»–æ¨¡å‹çš„å…³ç³»**

* ä¸HMMçš„å…³ç³»

  HMMç›´æ¥æ±‚è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œå¯¹äºæ ‡æ³¨é—®é¢˜è€Œè¨€ï¼Œæ˜¾ç„¶ä¸éœ€è¦æ±‚è”åˆæ¦‚ç‡åˆ†å¸ƒï¼Œæ±‚æ¡ä»¶æ¦‚ç‡å°±å¯ä»¥äº†ï¼Œå› æ­¤MEMMæ¯”HMMæ›´ç®€å•

  æ‰“ç ´äº†HMMçš„è§‚æµ‹ç‹¬ç«‹å‡è®¾ï¼Œæ¯”å¦‚$$y_2$$çš„æ ‡æ³¨ä¸ä»…å’Œ$$x_1$$æœ‰å…³ï¼Œä¹Ÿå’Œ$$x_2$$æœ‰å…³ï¼Œç”šè‡³å¯ä»¥è¯´å’Œæ•´ä¸ª$$x$$éƒ½æœ‰å…³ç³»ï¼Œè¿™ä¸ªå‡è®¾æ›´åŠ åˆç†ï¼Œè§‚æµ‹é—´ä¸åº”è¯¥æ˜¯ç›¸äº’ç‹¬ç«‹çš„

> CRF

å°†MEMMçš„**æœ‰å‘è°ƒæ•´ä¸ºäº†æ— å‘**ï¼Œå› æ­¤æ­¤æ—¶çš„å½’ä¸€åŒ–å˜ä¸ºäº†å…¨å±€å½’ä¸€åŒ–ï¼Œè§£å†³äº†`æ ‡æ³¨åå·®é—®é¢˜`





#### æ¦‚ç‡ç”Ÿæˆæ¨¡å‹

> å»ºæ¨¡æ ¸å¿ƒ

æ˜¯å¯¹$$P(y|x)$$è¿›è¡Œå»ºæ¨¡

> ä¾‹å­_æœ´ç´ è´å¶æ–¯(Naive Bayes, NB)

`æœ´ç´ è´å¶æ–¯å‡è®¾`å…¬å¼å¦‚ä¸‹
$$
p(x|y=v_0) = \prod _{i=1}^{p}{p(x_i|y=1æˆ–0)}
$$
æœ´ç´ è´å¶æ–¯æ¨¡å‹ç®€åŒ–ä¸ºä¸‹å›¾:

![æœ´ç´ è´å¶æ–¯å‡è®¾](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/æœ´ç´ è´å¶æ–¯å‡è®¾.webp)

è¯¥å›¾å¯ä»¥å…¬å¼è¡¨è¾¾ä¸º$$x_i \bot x_j | y,i \neq j$$ï¼Œæ„æ€æ˜¯åœ¨ç»™å®š$$y$$çš„æƒ…å†µä¸‹ï¼Œ$$x_i$$ç‹¬ç«‹äº$$x_j$$

æˆ–è€…å¯ä»¥è§£é‡Šä¸º$$x_j$$å’Œ$$x_j$$ä¹‹é—´å—åˆ°$$y$$çš„é˜»éš”ï¼Œå› æ­¤åœ¨ç»™å®š$$y$$çš„æƒ…å†µä¸‹ï¼Œ$$x_i$$ç‹¬ç«‹äº$$x_j$$

> ä¾‹å­_éšé©¬å°”ç§‘å¤«(Hidden Markov Model, HMM)

æœ´ç´ è´å¶æ–¯ä¸­çš„$$y$$æ˜¯åˆ†ç±»é—®é¢˜ï¼Œå¦‚æœè¿™é‡ŒæŠŠ$$y$$çœ‹ä½œæ˜¯ä¸€ä¸ªæ ‡æ³¨é—®é¢˜ï¼Œæ­¤æ—¶æ¼”åŒ–ä¸ºåºåˆ—é¢„æµ‹

![æœ´ç´ è´å¶æ–¯åˆ°éšé©¬å°”ç§‘å¤«](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/æœ´ç´ è´å¶æ–¯åˆ°éšé©¬å°”ç§‘å¤«.webp)

**HMM**æœ‰ä¸¤ä¸ªé‡è¦å‡è®¾

`é½æ¬¡Markovå‡è®¾`ï¼š

`è§‚æµ‹ç‹¬ç«‹å‡è®¾`ï¼šå…¬å¼è¡¨è¾¾ä¸º$$x_i \bot x_j | y_i,i \neq j$$ï¼Œæ„æ€æ˜¯åœ¨ç»™å®š$$y_i$$çš„æƒ…å†µä¸‹ï¼Œ$$x_i$$ç‹¬ç«‹äº$$x_j$$

> ä¾‹å­_é«˜æ–¯æ··åˆæ¨¡å‹(Gaussian mixture model, GMM)

![é«˜æ–¯æ··åˆæ¨¡å‹ç®€å›¾](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/é«˜æ–¯æ··åˆæ¨¡å‹ç®€å›¾.webp)






NB-(0/1 å˜ seq)-> HMM

GMM-(+times)-> HMM

## æ¦‚ç‡å›¾æ¨¡å‹ç»“æ„

D-Separationæ˜¯ä¸€ç§ç”¨æ¥åˆ¤æ–­å˜é‡æ˜¯å¦æ¡ä»¶ç‹¬ç«‹çš„å›¾å½¢åŒ–æ–¹æ³•ã€‚æ¢è¨€ä¹‹ï¼Œå¯¹äºä¸€ä¸ªDAG(æœ‰å‘æ— ç¯å›¾)Eï¼ŒD-Separationæ–¹æ³•å¯ä»¥å¿«é€Ÿçš„åˆ¤æ–­å‡ºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æ˜¯å¦æ˜¯æ¡ä»¶ç‹¬ç«‹çš„

> head-to-head(a->c<-b)

```mermaid

graph TB
	A --> C
	B --> C
```

åœ¨cæœªçŸ¥çš„æ¡ä»¶ä¸‹ï¼Œaã€bè¢«é˜»æ–­(blocked)ï¼Œæ˜¯ç‹¬ç«‹çš„ã€‚åè¿‡æ¥è®²ï¼Œåœ¨cå·²çŸ¥çš„æ¡ä»¶ä¸‹ï¼Œaã€bæ˜¯è¿é€šçš„ï¼Œä¸ç‹¬ç«‹ã€‚æ•°å­¦è¡¨ç¤ºæ˜¯
$$
\begin{align}
    P(a,b,c)&= P(a)*P(b)*P(c|a,b) \\
    \sum_c P(a,b,c)&=\sum_c P(a)*P(b)*P(c|a,b) \\
    P(a,b)&=P(a)*P(b)
\end{align}
$$

> tail-to-tail

```mermaid
graph TB
	C --> A
	C --> B
```

åœ¨cç»™å®šçš„æ¡ä»¶ä¸‹ï¼Œaï¼Œbè¢«é˜»æ–­(blocked)ï¼Œæ˜¯ç‹¬ç«‹çš„ã€‚æ•°å­¦è¡¨ç¤ºæ˜¯
$$
\begin{align}
    P(a,b,c) &= P(c)*P(a|c)*P(b|c)  \\
    P(a,b|c) &= \frac{P(a,b,c)}{P(c)}  \\
    å°†å¼å­1å¸¦  & å…¥åˆ°å¼å­2ä¸­ï¼š\nonumber \\
    P(a,b|c) &=P(a|c)*P(b|c)
\end{align}
$$

> head-to-tail

```mermaid
graph LR
	A --> C --> B
```



åœ¨**cç»™å®šçš„æ¡ä»¶ä¸‹ï¼Œaï¼Œbè¢«é˜»æ–­(blocked)ï¼Œæ˜¯ç‹¬ç«‹çš„**ã€‚æ•°å­¦è¡¨ç¤ºæ˜¯$$P(a,b,c)=P(a)P(c|a)P(b|c)$$

åŒ–ç®€åå¯å¾—
$$
\begin{align}
P(a,b|c) &= \frac{P(a,b,c)}{P(c)}  \\
         &= \frac{P(a)*P(c|a)*P(b|c)}{P(c)}  \\
         &= \frac{P(a,c)*P(b|c)}{P(c)}  \\
         &= P(a|c)*P(b|c)
\end{align}
$$

## æ— å‘å›¾å› å­åˆ†è§£

è¿™é‡Œçš„æ— å‘å›¾ä»¥é©¬å°”ç§‘å¤«éšæœºåœºMRFä¸¾ä¾‹
$$
p(x) = \frac {1}{Z} \prod _{i=1}^{K}{\psi _i (x_{c_i})} = \frac {1}{Z} \prod _{i=1}^{K}{exp([-E_i(x_{c_i})])} = \frac {1}{Z} exp (\sum _{i=1}^{K} {F_i(x_{c_i})})
$$
å…¶ä¸­ï¼Œ$$K$$æ˜¯æœ€å¤§å›¢çš„ä¸ªæ•°ï¼Œ$$C_i$$æ˜¯ç¬¬$$i$$ä¸ªæœ€å¤§å›¢ï¼Œæ ¹æ®å› å­åˆ†è§£å®šç†ï¼Œè¦æ±‚åŠ¿å‡½æ•°$$\psi _i \gt 0$$ï¼Œ$$x_{c_i}$$æ˜¯æœ€å¤§å›¢çš„è¡¨è¾¾

é€šå¸¸æŒ‡å®šåŠ¿å‡½æ•°$$\psi _i$$æ˜¯ä¸€ä¸ªæŒ‡æ•°å‡½æ•°ï¼Œ$$E_i(x_{c_i})$$æ˜¯ä¸€ä¸ªèƒ½é‡å‡½æ•°ï¼Œ$$F_i$$æ˜¯$$-E_i$$çš„ç®€åŒ–è¡¨è¾¾ï¼Œéƒ½æ˜¯ä¸€ä¸ªå‡½æ•°

å›¢çš„å®šä¹‰æ˜¯å­å›¾ä¸­æ¯ä¸ªç‚¹éƒ½èƒ½ç›¸äº’è¿é€š



# æ¼”åŒ–

## HMM

> [é©¬å°”ç§‘å¤«éšæœºåœº(MRF)åœ¨å›¾åƒå¤„ç†ä¸­çš„åº”ç”¨-å›¾åƒåˆ†å‰²ã€çº¹ç†è¿ç§»](https://oldpan.me/archives/markov-random-field-deeplearning)

HMMæ˜¯ä¸€ä¸ªç”Ÿæˆæ¨¡å‹ï¼Œå¯ä»¥çœ‹æˆæ˜¯NBæˆ–GMMçš„æ³›åŒ–

å‚æ•°å®šä¹‰ä¸º$$\lambda = (\pi , A, B)$$ï¼Œå…¶ä¸­$$\pi$$æ˜¯åˆå§‹çŠ¶æ€åˆ†å¸ƒã€$$A$$æ˜¯yä¹‹é—´çš„çŠ¶æ€è½¬ç§»çŸ©é˜µ($$y_t$$åˆ°$$y_{t+1}$$çš„æ¦‚ç‡)ã€$$B$$æ˜¯ä»$$y$$å‘å°„åˆ°$$x$$çš„å‘å°„çŸ©é˜µ

**HMMæœ‰ä¸¤ä¸ªé‡è¦å‡è®¾**(éå¿…é¡»ï¼ŒæŠ˜ä¸­çš„æ–¹å¼ï¼Œå‡å°‘è®¡ç®—é‡)

`ä¸€é˜¶é½æ¬¡Markovå‡è®¾`ï¼š

ä¸€é˜¶: å«ä¹‰ä¸º$$y_i$$åªå’Œ$$y_{i-1}$$æœ‰å…³ç³»ï¼Œæˆ–è€…è¡¨è¿°ä¸ºç»™å®š$$y_{i-1}$$çš„æƒ…å†µä¸‹$$y_i$$å’Œ$$y_{i-2}$$æ˜¯æ— å…³çš„ï¼ŒäºŒé˜¶çš„è¯å°±æ˜¯ç»™å®š$$y_{i-1}$$å’Œ$$y_{i-2}$$çš„æƒ…å†µä¸‹$$y_i$$å’Œ$$y_{i-3}$$æ˜¯æ— å…³çš„

é½æ¬¡: å«ä¹‰ä¸º$$y_1, \cdots , y_i$$æ¯ä¸ª$$y$$çš„æ¦‚ç‡æ˜¯æ˜¯ä¸€è‡´ï¼Œä¹Ÿå¯ä»¥è¡¨è¿°ä¸º$$p(y_t|y_{t+1})$$å’Œ$$p(y_{t-1}|y_{t-2})$$æ˜¯ç›¸ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯ä¸æ—¶é—´$$t$$æ— å…³

æœ¯è¯­åŒ–è¡¨è¾¾: $$p(y_t|y_{1:t-1},x_{1:t-1}) = p(y_t|y_{t-1})$$

`è§‚æµ‹ç‹¬ç«‹å‡è®¾`ï¼šå…¬å¼è¡¨è¾¾ä¸º$$x_i \bot x_j | y_i,i \neq j$$ï¼Œæ„æ€æ˜¯åœ¨ç»™å®š$$y_i$$çš„æƒ…å†µä¸‹ï¼Œ$$x_i$$ç‹¬ç«‹äº$$x_j$$

æœ¯è¯­åŒ–è¡¨è¾¾: $$p(x_t|y_{1:t-1},x_{1:t-1}) = p(x_t|y_{t})$$

**å»ºæ¨¡å¯¹è±¡**å¦‚ä¸‹
$$
p(X,Y| \lambda) = \prod _{t-1}^T{p(x_t, y_t| \lambda)} = \prod _{t-1}^T{p(y_t|y_{t-1}, \lambda)} \prod _{t-1}^T{p(x_t|y_{t}, \lambda)}
$$
è®¡ç®—å¤æ‚åº¦å¤ªé«˜ï¼Œäºæ˜¯å¼•å…¥äº†å‰å‘åå‘ç®—æ³•

## MEMM

![æœ€å¤§ç†µé©¬å°”ç§‘å¤«å›¾æ¨¡å‹](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/æœ€å¤§ç†µé©¬å°”ç§‘å¤«å›¾æ¨¡å‹.webp)

ä¸HMMæ¯”è¾ƒï¼Œå°†$$x$$å˜ä¸ºäº†$$y$$çš„è¾“å…¥ï¼Œæ­¤æ—¶ç»™å®š$$y_t$$çš„æƒ…å†µä¸‹ï¼Œ$$x_t$$å’Œ$$x_{t-1}$$ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œä»è€Œ**æ‰“ç ´è§‚æµ‹ç‹¬ç«‹æ€§å‡è®¾**

æ­¤æ—¶çš„MEMMå»ºæ¨¡å¯¹è±¡å˜ä¸ºäº†æ¡ä»¶æ¦‚ç‡ï¼Œä¸ºåˆ¤åˆ«æ¨¡å‹
$$
p(Y|X, \lambda) = \prod _{t=1}^T{p(y_t| y_{t-1}, x_{1:t}, \lambda)}
$$
åœ¨è¿™é‡Œï¼Œåˆ¤åˆ«å¼çš„æ¨¡å‹æ¯”ç”Ÿæˆå¼æ¨¡å‹è¦å¥½

å› ä¸ºï¼šä»»åŠ¡é©±åŠ¨çš„ï¼Œåœ¨è¿™æ ·çš„åºåˆ—æ ‡æ³¨ä»»åŠ¡ä¸Šï¼Œåœ¨ç»™å®šä¸€ä¸ªå¾…æ ‡æ³¨åºåˆ—ï¼Œæˆ‘ä»¬æ›´å…³æ³¨çš„æ˜¯æ ‡æ³¨çš„æ˜¯ä»€ä¹ˆï¼Œå› æ­¤ï¼Œå¯¹äºè¿™æ ·çš„ä»»åŠ¡æˆ‘ä»¬åªéœ€è¦å¯¹æ¡ä»¶æ¦‚ç‡å»ºæ¨¡å°±è¶³çŸ£äº†ï¼Œè€Œå»æ±‚è”åˆæ¦‚ç‡åˆ†å¸ƒå°±å°†é—®é¢˜å¤æ‚åŒ–äº†(è®¡ç®—ä¹Ÿå¤æ‚åŒ–äº†)

è¿™é‡ŒæŠŠæ•´ä¸ªè¾“å…¥$$X$$åˆ†æˆäº†2ä¸ªéƒ¨åˆ†ï¼Œ$$X=(x_g,x_{1:T})$$ï¼Œå³å¯¹$$Y$$çš„å½±å“åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼šå…¨å±€çš„å½±å“+å±€éƒ¨çš„å½±å“

ä¸»è¦ç¼ºç‚¹æ˜¯ä¼šé€ æˆLabel Bias Problemï¼Œï¼ˆåœ¨John Laffertyè®ºæ–‡ä¸­ï¼ŒæŒ‡å‡ºäº†MEMMä¼šé€ æˆLabel Bias Problemé—®é¢˜ï¼‰

çœ‹ä¸Šæ–¹ç°è‰²æ¡†å†…çš„å±€éƒ¨ï¼Œå¯ä»¥ç®€å•çœ‹æˆæ˜¯é€»è¾‘å›å½’ï¼Œåœ¨è¿™ä¸ªæœ€å°å•å…ƒæˆ‘ä»¬æŠŠå®ƒå½“æˆä¸€ä¸ªç³»ç»Ÿï¼Œç³»ç»Ÿä»$$y_{tâˆ’1}$$åˆ°$$y_t$$çš„è¿™æ ·ä¸€ä¸ªè½¬ç§»ç”¨æ•°å­¦å¯ä»¥è¡¨ç¤ºæˆä¸€ä¸ªå‡½æ•°ï¼Œæ˜¯å—$$y_{tâˆ’1}$$ã€$$y_t$$ä¸$$x_t$$å…±åŒä½œç”¨çš„ä¸€ä¸ªå‡½æ•°ï¼Œç³»ç»Ÿå¯¹å¤–æ˜¯æœ‰ä¸€å®šèƒ½é‡çš„ï¼Œè¿™ä¸ªå‡½æ•°è¢«ç§°ä¸º`Mass Score`ï¼Œè€Œä¸”æ˜¯å¤§äº0çš„ã€‚ä½†æ˜¯é—®é¢˜å‡ºç°åœ¨ï¼šè¿™ä¸ªMass Scoreè¢«å±€éƒ¨å½’ä¸€åŒ–äº†ã€‚æ¡ä»¶æ¦‚ç‡ç†µè¶Šå°ï¼Œé‚£ä¹ˆå¯¹äºè§‚æµ‹å€¼çš„è€ƒè™‘è¶Šå°‘

> ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å®ƒçš„é—®é¢˜æ‰€åœ¨ï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªæ¯”è¾ƒæç«¯çš„[ä¾‹å­](https://anxiang1836.github.io/2019/11/05/NLP_From_HMM_to_CRF/)

![LabelBiasProblem](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/LabelBiasProblem.webp)

æ¯”å¦‚ï¼Œæˆ‘ä»¬è®­ç»ƒå¥½äº†è¿™æ ·çš„ä¸€ä¸ªæ¨¡å‹ï¼Œç°æœ‰ä¸€ä¸ªè§‚æµ‹åºåˆ—æ˜¯rib

1. åœ¨çŠ¶æ€0æ—¶ï¼Œç”±äº$$P(4|0)>P(1|0)$$ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©ä»$$0â†’4$$è½¬ç§»è·¯å¾„ï¼›
2. é—®é¢˜å‡ºç°åœ¨äº†ç¬¬äºŒæ­¥è½¬ç§»ä¸Šï¼šç”±äº$$P(5|4)=1$$ï¼Œæ˜¯å—åˆ°äº†å±€éƒ¨å½’ä¸€åŒ–çš„å½±å“ï¼Œä»4çŠ¶æ€è½¬ç§»ä»…æœ‰1æ¡è·¯å¾„é€‰æ‹©ï¼Œå…¶è½¬ç§»çš„æ¡ä»¶æ¦‚ç‡ä¸º1ï¼Œå…¶æ‰€å…·æœ‰çš„ç†µå€¼ä¸º0

ä¸ºä»€ä¹ˆä»4çŠ¶æ€å‘5è½¬ç§»çš„æ¡ä»¶æ¦‚ç‡ä¸º1

æ­£æ˜¯å› ä¸ºMEMMåœ¨æ¯ä¸€æ­¥è½¬ç§»çš„æ¦‚ç‡éƒ½æ˜¯è¦åš**å±€éƒ¨å½’ä¸€åŒ–**çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»4çŠ¶æ€å‘å¤–è½¬ç§»çš„æ‰€æœ‰çš„æƒ…å†µåŠ å’Œè¦ä¸º1ï¼Œåœ¨è¿™é‡Œï¼Œä»…æœ‰1ä¸­è½¬ç§»æƒ…å†µï¼Œæ‰€ä»¥$$P(5|4)=1$$

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºè§‚æµ‹å€¼ä¸ºä»€ä¹ˆï¼Œéƒ½ä¸ä¼šå½±å“$$4â†’5$$çš„è½¬ç§»ï¼Œä½†æ˜¯ï¼Œè¿™æ ·æ ‡æ³¨å‡ºæ¥çš„åºåˆ—$$0â†’4â†’5â†’3$$ï¼Œå³robå°±ä¸å®¢è§‚äº‹å®ä¸ç¬¦äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯é—®é¢˜çš„æ‰€åœ¨

## CRF

æ‰€ä»¥ï¼Œä¸ºäº†è§£å†³å±€éƒ¨å½’ä¸€åŒ–çš„é—®é¢˜ï¼ŒCRFå–æ¶ˆäº†Yåºåˆ—çš„è½¬ç§»æ–¹å‘ï¼Œä¹Ÿå°±æ˜¯å–æ¶ˆäº†å±€éƒ¨å½’ä¸€åŒ–ï¼Œæ”¹å˜ä¸ºäº†`å…¨å±€å½’ä¸€åŒ–`  



# CRF

CRFæ˜¯é©¬å°”ç§‘å¤«éšæœºåœºMRFçš„ç‰¹ä¾‹ï¼Œå®ƒå‡è®¾é©¬å°”ç§‘å¤«éšæœºåœºä¸­åªæœ‰ğ‘‹å’Œğ‘Œä¸¤ç§å˜é‡ï¼Œğ‘‹ä¸€èˆ¬æ˜¯ç»™å®šçš„ï¼Œè€Œğ‘Œä¸€èˆ¬æ˜¯åœ¨ç»™å®šğ‘‹çš„æ¡ä»¶ä¸‹æˆ‘ä»¬çš„è¾“å‡ºã€‚è¿™æ ·é©¬å°”ç§‘å¤«éšæœºåœºå°±ç‰¹åŒ–æˆäº†æ¡ä»¶éšæœºåœº

* **æ¡ä»¶**ä½“ç°åœ¨å®ƒæ˜¯åˆ¤åˆ«å¼æ¨¡å‹ï¼Œè®¡ç®—æ¡ä»¶æ¦‚ç‡
* **éšæœºåœº**ä½“ç°åœ¨æ˜¯æ— å‘å›¾æ¨¡å‹ï¼Œæˆ–è€…è¯´æ˜¯é©¬å°”ç§‘å¤«éšæœºåœºMRF

![æ¡ä»¶éšæœºåœº](https://pic.hycbook.com/i/hexo/bk_resources/machine_learning/æ¡ä»¶éšæœºåœºCRF/æ¡ä»¶éšæœºåœº.webp)

å›¾ä¸­$$y_0$$å’Œ$$y_{T+1}$$æ˜¯ä¸ºäº†è¡¨è¾¾ä¸Šçš„æ–¹ä¾¿

é€šå¸¸åœ¨æ²¡æœ‰è¯´æ˜çš„æƒ…å†µä¸‹ï¼ŒCRFæŒ‡çš„å°±æ˜¯çº¿æ€§é“¾æ¡ä»¶éšæœºåœº

## æ¦‚ç‡å¯†åº¦å‡½æ•°å‚æ•°åŒ–

æ ¹æ®æ— å‘å›¾å› å­åˆ†è§£å…¬å¼ï¼Œæ¦‚ç‡å¯†åº¦å‡½æ•°å¯ä»¥è¡¨è¾¾ä¸º
$$
p(Y|X) = \frac {1}{Z} exp (\sum _{i=1}^{K} {F_i(x_{c_i})}) = \frac {1}{Z} exp (\sum _{t=1}^{T} {F(y_{t-1},y_t, x_{1:T})})
$$
å…¶ä¸­æœ€å¤§å›¢$$x_{c_i}$$å±•å¼€ä¹‹åå°±æ˜¯$$(y_{t-1},y_t, x_{1:T})$$

å› ä¸ºè¿™é‡Œæ˜¯çº¿æ€§é“¾ï¼Œæ¯ä¸ªç»“æ„éƒ½ä¸€æ ·ï¼Œæ²¡æœ‰å¿…è¦ä¸ºæ¯ä¸€ä¸ªéƒ½è®¾ä¸€ä¸ªå‡½æ•°ï¼Œå› æ­¤è¿™é‡Œè¡¨è¾¾ä¸º$$F$$è€Œä¸æ˜¯$$F_i$$

æ¥ç€ï¼Œæˆ‘ä»¬å›¾ä¸­ç°è‰²æ¡†éƒ¨åˆ†ä¸¾ä¾‹ï¼Œè¿™é‡Œå¯ä»¥æŠŠ$$F(y_{t-1},y_t, x_{1:T})$$æ‹†æˆä¸‰éƒ¨åˆ†é‡çœ‹ï¼Œ$$y_t$$ã€$$y_{t-1}$$å’Œå®ƒä»¬ä¹‹é—´è¾¹çš„å…³ç³»
$$
F(y_{t-1},y_t, x_{1:T}) = \Delta_{y_{t-1}, x_{1:T}} + \Delta_{y_{t}, x_{1:T}} + \Delta_{y_{t-1}, t_{t}, x_{1:T}} = \Delta_{y_{t}, x_{1:T}} + \Delta_{y_{t-1}, t_{t}, x_{1:T}}
$$
å‰ä¸¤ä¸ªå¯ä»¥çœ‹æˆ`çŠ¶æ€å‡½æ•°`ï¼Œç¬¬ä¸‰ä¸ªå¯ä»¥çœ‹æˆæ˜¯`çŠ¶æ€è½¬ç§»å‡½æ•°`

åŒæ—¶ç¬¬ä¸€ä¸ªå¯ä»¥å¿½ç•¥æ‰ï¼ŒåŸå› åœ¨äºç›®å‰æ˜¯åœ¨$$t$$æ—¶åˆ»ï¼Œè€Œåœ¨$$t-1$$æ—¶åˆ»æ—¶ï¼Œå·²ç»æœ‰$$y_{t-1}$$äº†ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ç¬¬äºŒéƒ¨åˆ†

> è¿™é‡Œçš„ä¸ºä»€ä¹ˆå¯ä»¥æŠŠFæ‹†æˆä¸‰éƒ¨åˆ†å‘¢ï¼Œä»å›¾ä¸Šçœ‹å¯èƒ½æœ‰äº›çªå…€ï¼Œè¿™é‡Œå¯ä»¥å¸¦å…¥åˆ°`æ ‡æ³¨é—®é¢˜`æ¥ç†è§£

æ¯”å¦‚è¿™é‡Œæœ‰ä¸€å¥è¯: å°æ˜ æ˜¯ ä¸­å›½äºº

å‡è®¾è¿™é‡Œå·²ç»åˆ†è¿‡è¯äº†ï¼Œè¿™é‡Œè¦å»åˆ¤æ–­è¯æ€§ï¼Œè¿™é‡Œ$$y_{t-1}$$å’Œ$$y_t$$æ˜¯å±äºè¯æ€§{åè¯ã€å½¢å®¹è¯ã€åŠ¨è¯ã€...}çš„é›†åˆ

å› æ­¤è¿™é‡Œå‰ä¸¤ä¸ªå¯ä»¥çœ‹æˆçŠ¶æ€å‡½æ•°

> 

$$
\Delta_{y_{t-1}, t_{t}, x_{1:T}} = \sum _{k=1}^{K}{\lambda _k f_k(y_{t-1}, t_{t}, x_{1:T})}
$$

å…¶ä¸­$$f_k$$æ˜¯ä¸€ä¸ªç‰¹å¾å‡½æ•°ï¼Œä¸€èˆ¬æ˜¯æŒ‡ç¤ºå‡½æ•°ï¼Œæ¯”å¦‚$$f_k \lbrace y_{t-1}=åè¯, y_{t}=åŠ¨è¯, x_{1:T} \rbrace = 1$$

$$\lambda _k$$æ˜¯æœ€ç»ˆéœ€è¦å­¦ä¹ çš„å‚æ•°
$$
\Delta_{y_{t}, x_{1:T}} = \sum _{l=1}^{L}{\eta _l g_l (y_t, x_{1:T})}
$$
å…¶ä¸­$$\eta _l $$å’Œ$$ g_l$$çš„ä»£è¡¨å«ä¹‰åŒä¸Š

> å¸¦å…¥å¾—åˆ°æœ€åçš„CRFæ¡ä»¶æ¦‚ç‡å¯†åº¦å‡½æ•°

$$
p(Y|X) = \frac {1}{Z} exp (\sum _{i=1}^{K} {F_i(x_{c_i})}) = \frac {1}{Z} exp (\sum _{t=1}^{T} {F(y_{t-1},y_t, x_{1:T})}) = \\
\frac {1}{Z} exp (\sum _{t=1}^{T} [\sum _{k=1}^{K}{\lambda _k f_k(y_{t-1}, t_{t}, x_{1:T})} + \sum _{l=1}^{L}{\eta _l g_l (y_t, x_{1:T})}]
$$

å†™å‡ºæ¦‚ç‡å¯†åº¦å‡½æ•°ä¹‹åï¼Œå°±å¯ä»¥æ±‚è§£äº†
